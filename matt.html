<html>
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type">
    <meta name=viewport content="width=device-width, initial-scale=1">
    <title></title>
    <style>
    body {
      font-size: 16px;
    }

    .small {
      font-size: 12px; /* 75% of the baseline */
    }

    .large {
      font-size: 20px; /* 125% of the baseline */
    }
    span {
      color: #1d3cdf;
      cursor: pointer;
      text-decoration: underline;
    }

    span: hover {
      color: #1da9df;
    }
  </style>
  </head>
  <body onload="writeBook()">
    <div>
      <audio controls="controls" style="width:50%" id="audio1">Canvas not supported</audio>
      <div id="nowPlaying">&nbsp;</div>
    </div>
    <hr>
      <input size="60" id="audioFile" type="hidden">
      <button onclick="togglePlay()" id="playbutton">&#9658;</button>
      <button onclick="skipAudio(-10);">&lt; 10s</button>
      <button onclick="skipAudio(-5);">&lt; 5s</button>
      <button onclick="skipAudio(20);">&gt; 20s</button>
      <br>
      <button onclick="setSpeed(.6);">60%</button>
      <button onclick="setSpeed(.8);">80%</button>
      <button onclick="setSpeed(1);">100%</button>
      <button onclick="setSpeed(1.2);">120%</button>
      <input id="currentTime" type="hidden"> <input id="endTime" type="hidden">
    <div id="rate">&nbsp;</div>
    <input value="1" id="showrate" type="hidden">
    <div id="debug">&nbsp;</div>
    <hr>
    Search:
    <input id="search" type="text" style="width:70%">
    <button onclick="search()">Submit</button>
    <hr>
    <div id="verses"></div>
    <script src="js/matt.js"></script>
    <script type="text/javascript">

      function search() {
        var term = document.getElementById("search").value.trim();
        var links = "";

        var chapters = books[0].chapters;

        for (var i=0; i < chapters.length; i++) {
          var verses = chapters[i].verses;
          for (var k=0; k < verses.length; k++) {
            if (verses[k].text.toLowerCase().includes(term.toLowerCase())) {
              links += "<div><span onclick=\"playSnippet(this.id, this.innerHTML, ";
              links += verses[k].start + ", ";
              links += verses[k].end + ")\" size=\"60\" id=\"" + chapters[i].audio + "\">";
  				    links += chapters[i].chapter + ":";
  					  links += verses[k].verse + "</span> ";
  					  links += verses[k].text;
  					  links += "</div>";
            }
          }
        }

        document.getElementById("verses").innerHTML = links;
      }

      function writeBook() {
        var links = "";
        //Book name
        links += books[0].book + "<br>";

        var chapters = books[0].chapters;

        for (var i=0; i < chapters.length; i++) {
          var verses = chapters[i].verses;
          //Chapter
          links += "<br><div><span onclick=\"playSnippet(this.id, this.innerHTML, ";
          links += verses[0].start + ", ";
          links += verses[verses.length-1].end + ")\" size=\"60\" id=\"" + chapters[i].audio + "\">";
  				links += "Capitulum " + chapters[i].chapter + "</span> ";
  				links += "</div>";

          for (var k=0; k < verses.length; k++) {
            //verse
            links += "<div><span onclick=\"playSnippet(this.id, this.innerHTML, ";
            links += verses[k].start + ", ";
            links += verses[k].end + ")\" size=\"60\" id=\"" + chapters[i].audio + "\">";
  				  links += chapters[i].chapter + ":";
  					links += verses[k].verse + "</span> ";
  					links += verses[k].text;
  					links += "</div>";
          }

        }

        document.getElementById("verses").innerHTML = links;
      }

      function writeVerses() {
        var links = "";

        for (var i=0; i < chapters.length; i++) {
          var verses = chapters[i].verses;
          //links += chapters[i].chapter;
          for (var k=0; k < verses.length; k++) {
            links += "<div><span onclick=\"playSnippet(this.id, this.innerHTML, ";
            links += verses[k].start + ", ";
            links += verses[k].end + ")\" size=\"60\" id=\"" + chapters[i].audio + "\">";
  				  links += chapters[i].chapter + ":";
  					links += verses[k].verse + "</span> ";
  					links += verses[k].text;
  					links += "</div>";
          }

        }


        document.getElementById("verses").innerHTML = links;


      }

        var audioElm = document.getElementById("audio1"); // Audio element
        var ratedisplay = document.getElementById("rate"); // Rate display area
        var showRateInput = document.getElementById("showrate");
        var debug = false;
        var nowPlaying = document.getElementById("nowPlaying");
        nowPlaying.innerHTML = "Now playing: ";

      	function playSnippet(value, text, startSecs, durationSecs) {
            var link = "audio/" + value
            document.getElementById("audioFile").value = link;
            audioElm.src = link;
            ratedisplay = document.getElementById("rate"); // Rate display area
            showRateInput = document.getElementById("showrate");
            nowPlaying.innerHTML = "Now playing: " + text;
            playAudio2(startSecs, durationSecs);
          showDebug();

        }

      function playAudio2(startSecs, durationSecs) {
            document.getElementById("playbutton").innerHTML = "&#10074;&#10074;"; // Set button text == Pause
            // Get file from text box and assign it to the source of the audio element
            audioElm.playbackRate = document.getElementById("showrate").value;
            audioElm.currentTime = startSecs;
            document.getElementById("endTime").value = durationSecs;
            audioElm.play();
            var ct = setInterval(getCurrentTime, 200);

            showDebug();
        }

      function getCurrentTime() {
        var time = audioElm.currentTime;
        var end = document.getElementById("endTime").value;
        document.getElementById("currentTime").value = time;
        if (time > end) {
          audioElm.pause();
        }

      }




        function showDebug() {
            if (debug) {
                var msg = "Displayed rate: " + document.getElementById("showrate").value;
                msg += "<br>Playback rate: " + audioElm.playbackRate;
                msg += "<br>Current time: " + audioElm.currentTime;
                document.getElementById("debug").innerHTML = msg;
            }
        }

        function loadFile(value, text) {
            var link = "audio/" + value
            document.getElementById("audioFile").value = link;
            audioElm.src = link;
            ratedisplay = document.getElementById("rate"); // Rate display area
            showRateInput = document.getElementById("showrate");
            nowPlaying.innerHTML = "Now playing: " + text;
            playAudio();
            showDebug();
        }


        //  Alternates between play and pause based on the value of the paused property
        function togglePlay() {
            if (document.getElementById("audio1")) {
                if (audioElm.paused == true) {
                    playAudio(audioElm);    //  if player is paused, then play the file
                } else {
                    pauseAudio(audioElm);   //  if player is playing, then pause
                }
            }
        }

        function skipAudio(interval) {
            if (window.HTMLAudioElement) {
                try {
                    audioElm.currentTime += interval;
                } catch (e) {
                    // Fail silently but show in F12 developer tools console
                    if(window.console && console.error("Error:" + e));
                }
            }
            showDebug();
        }

        function playAudio() {
            document.getElementById("playbutton").innerHTML = "&#10074;&#10074;"; // Set button text == Pause
            // Get file from text box and assign it to the source of the audio element
            audioElm.playbackRate = document.getElementById("showrate").value;
            audioElm.play();
            showDebug();
        }

        function pauseAudio() {
            document.getElementById("playbutton").innerHTML = "&#9658;"; // Set button text == Play
            audioElm.pause();
            showDebug();
        }

        function setSpeed(speed) {
            showRateInput.value = speed;
            audioElm.playbackRate = speed;
            showDebug();
        }
    </script>
  </body>
</html>
